[[extend 'layout.html']]

<ul class="nav nav-tabs mb-4">
    <li class="nav-item">
        <a class="nav-link active" href="#">Distinct Feature Identifier</a>
    </li>
    <li class="nav-item">
        <a class="nav-link disabled" href="#">Coming Soon</a>
    </li>
</ul>

<div class="row">
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">Configuration</div>
            <div class="card-body">
                <form action="[[=URL('process_image')]]" method="POST" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label class="form-label">Image</label>
                        <input type="file" name="image" class="form-control" required accept=".jpg,.jpeg,.png,.webp">
                    </div>
                    
                    <h6 class="mt-3">Expected Dimensions</h6>
                    <div class="row g-2">
                        <div class="col-6">
                            <label class="form-label small">Min Width</label>
                            <input type="number" name="min_w" class="form-control" value="[[=form_data.get('min_w', 10)]]">
                        </div>
                        <div class="col-6">
                            <label class="form-label small">Max Width</label>
                            <input type="number" name="max_w" class="form-control" value="[[=form_data.get('max_w', 500)]]">
                        </div>
                        <div class="col-6">
                            <label class="form-label small">Min Height</label>
                            <input type="number" name="min_h" class="form-control" value="[[=form_data.get('min_h', 10)]]">
                        </div>
                        <div class="col-6">
                            <label class="form-label small">Max Height</label>
                            <input type="number" name="max_h" class="form-control" value="[[=form_data.get('max_h', 500)]]">
                        </div>
                    </div>
                    
                    <div class="mb-3 mt-3">
                        <label class="form-label">Delta E Threshold</label>
                        <input type="number" step="0.1" name="threshold" class="form-control" value="[[=form_data.get('threshold', 2.3)]]">
                        <div class="form-text">CIE76 threshold (e.g. 2.3 is perceptible difference)</div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary w-100">Run Detection</button>
                </form>
            </div>
        </div>
        
        [[if error:]]
        <div class="alert alert-danger mt-3">
            [[=error]]
        </div>
        [[pass]]
    </div>
    
    <div class="col-md-8">
        [[if results:]]
        <div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span>Results</span>
                <span class="badge bg-success">Found [[=len(results['bounding_boxes'])]] features</span>
                <span class="badge bg-secondary">[[=f"{results['processing_time_ms']:.2f} ms"]]</span>
            </div>
            <div class="card-body text-center">
                <img src="[[=overlay_url]]" class="img-fluid border rounded" alt="Processed Image">
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">Detections</div>
            <div class="card-body">
                <div class="table-responsive" style="max-height: 300px;">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>X</th>
                                <th>Y</th>
                                <th>W</th>
                                <th>H</th>
                                <th>Score</th>
                            </tr>
                        </thead>
                        <tbody>
                            [[for i, box in enumerate(results['bounding_boxes']):]]
                            <tr>
                                <td>[[=i+1]]</td>
                                <td>[[=box['x']]]</td>
                                <td>[[=box['y']]]</td>
                                <td>[[=box['w']]]</td>
                                <td>[[=box['h']]]</td>
                                <td>[[=f"{box['score']:.4f}"]]</td>
                            </tr>
                            [[pass]]
                        </tbody>
                    </table>
                </div>
                
                <hr>
                <h6>JSON Response</h6>
                <textarea class="form-control" rows="5" readonly>[[=json_data]]</textarea>
            </div>
        </div>
        [[else:]]
        <div class="alert alert-info">
            Upload an image and set parameters to detect features.
        </div>
        [[pass]]
    </div>
</div>

